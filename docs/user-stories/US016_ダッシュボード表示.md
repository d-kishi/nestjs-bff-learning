# US016: ダッシュボード表示

## ストーリー

認証済みユーザーとして、
ダッシュボード画面でタスクとプロジェクトの概要を確認したい。
それにより、自分の作業状況を素早く把握できる。

## 受け入れ基準

- ログイン後、ダッシュボード画面が表示される
- ユーザー情報（表示名）が表示される
- タスクサマリー（TODO/IN_PROGRESS/DONE件数）が表示される
- プロジェクトサマリー（総数/所有数）が表示される
- 直近のタスク一覧（最大5件）が表示される
- データ取得中はローディング表示される
- 部分失敗時は取得できたデータのみ表示し、警告を表示する

## アンチパターン（これは仕様に含まない）

- タスク・プロジェクトの詳細編集機能
- グラフ・チャートによる可視化
- カスタマイズ可能なウィジェット

---

## テストシナリオ

### 正常系

#### シナリオ1: ダッシュボード正常表示

- **Given（前提）**:
  - ユーザーはログイン済み
  - task-service、user-serviceともに正常稼働
  - ユーザーはタスク10件、プロジェクト3件を所有
- **When（操作）**:
  - ダッシュボード画面（`/dashboard`）にアクセス
- **Then（結果）**:
  - 「ようこそ、{displayName} さん」が表示される
  - タスクサマリーにTODO/IN_PROGRESS/DONE件数が表示される
  - プロジェクトサマリーに総数/所有数が表示される
  - 直近タスク一覧に最大5件表示される
  - 各タスクにタイトル、プロジェクト名、ステータス、優先度、期限が表示される

#### シナリオ2: ローディング表示

- **Given（前提）**:
  - ユーザーはログイン済み
- **When（操作）**:
  - ダッシュボード画面にアクセス
  - APIレスポンス待機中
- **Then（結果）**:
  - ローディングスピナーが表示される
  - データ取得完了後、スピナーが消えてデータが表示される

#### シナリオ3: タスク・プロジェクトが0件の場合

- **Given（前提）**:
  - ユーザーはログイン済み
  - タスク0件、プロジェクト0件
- **When（操作）**:
  - ダッシュボード画面にアクセス
- **Then（結果）**:
  - タスクサマリーは全て0件と表示される
  - プロジェクトサマリーは0件と表示される
  - 直近タスク一覧は「タスクがありません」と表示される

#### シナリオ4: ナビゲーション

- **Given（前提）**:
  - ユーザーはダッシュボード画面を表示中
- **When（操作）**:
  - ヘッダーの「Projects」リンクをクリック
- **Then（結果）**:
  - プロジェクト一覧画面（`/projects`）へ遷移する

---

### 異常系

#### シナリオ5: 部分失敗（user-service障害）

- **Given（前提）**:
  - ユーザーはログイン済み
  - user-serviceがダウン中
  - task-serviceは正常稼働
- **When（操作）**:
  - ダッシュボード画面にアクセス
- **Then（結果）**:
  - ユーザー情報は表示されない（または「取得できませんでした」）
  - タスクサマリー、直近タスクは正常表示される
  - 警告メッセージ「一部のデータを取得できませんでした」が表示される
  - `_errors` の内容がトーストまたは警告バナーで表示される

#### シナリオ6: 部分失敗（task-service障害）

- **Given（前提）**:
  - ユーザーはログイン済み
  - task-serviceがダウン中
  - user-serviceは正常稼働
- **When（操作）**:
  - ダッシュボード画面にアクセス
- **Then（結果）**:
  - ユーザー情報は正常表示される
  - タスクサマリーは0件表示（またはN/A）
  - プロジェクトサマリーは0件表示（またはN/A）
  - 直近タスクは「取得できませんでした」表示
  - 警告メッセージが表示される

#### シナリオ7: 完全失敗（ネットワークエラー）

- **Given（前提）**:
  - ユーザーはログイン済み
  - ネットワーク接続なし
- **When（操作）**:
  - ダッシュボード画面にアクセス
- **Then（結果）**:
  - エラーメッセージ「データを取得できませんでした」が表示される
  - 「再試行」ボタンが表示される

#### シナリオ8: 認証切れ

- **Given（前提）**:
  - ユーザーのアクセストークンが期限切れ
  - リフレッシュトークンも期限切れ
- **When（操作）**:
  - ダッシュボード画面にアクセス
- **Then（結果）**:
  - 401エラーを受信
  - 自動的にログアウト処理
  - ログイン画面へリダイレクト

---

## E2Eテスト（/webapp-testing用）

### テストスイート構成

```typescript
describe('ダッシュボード', () => {
  beforeEach(() => {
    // ログイン済み状態をセットアップ
  });

  describe('正常表示', () => {
    it('ユーザー情報が表示される');
    it('タスクサマリーが表示される');
    it('プロジェクトサマリーが表示される');
    it('直近タスク一覧が表示される');
  });

  describe('部分失敗', () => {
    it('user-service障害時も他のデータは表示される');
    it('警告メッセージが表示される');
  });

  describe('ナビゲーション', () => {
    it('ヘッダーからプロジェクト一覧へ遷移できる');
    it('ヘッダーからタスク一覧へ遷移できる');
  });
});
```

---

## 関連ドキュメント

- `docs/design/angular-ui-design.md` - ダッシュボード画面ワイヤーフレーム
- `docs/user-stories/US014_BFFデータ集約.md` - ダッシュボードAPI仕様
- `docs/design/api-gateway-api.md` - `GET /api/dashboard` 仕様
