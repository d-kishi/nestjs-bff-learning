# US003: タスク作成

## ストーリー

MEMBERユーザーとして、
プロジェクト内に新しいタスクを作成したい。
それにより、作業を管理・追跡できる。

## 受け入れ基準

- タイトル（必須）と説明（任意）を入力してタスクを作成できる
- プロジェクトID（必須）を指定する
- ステータス（デフォルト: TODO）と優先度（デフォルト: MEDIUM）を指定できる
- 期限日（任意）を指定できる
- 担当者（任意）を指定できる
- 作成時にタグを紐づけられる（任意）
- タイトルは1〜200文字

## アンチパターン（これは仕様に含まない）

- 存在しないプロジェクトIDを指定した場合はエラーとなる
- タスク作成と同時にコメントを追加することはできない
- 複数のタスクを一括で作成することはできない
- ステータスは TODO / IN_PROGRESS / DONE のみ
- 優先度は LOW / MEDIUM / HIGH のみ

## テストシナリオ

### 正常系

#### シナリオ1: 最小限の情報でタスクを作成

- **Given（前提）**: プロジェクト（id: 1）が存在する
- **When（操作）**: POST /tasks に `{"title": "新規タスク", "projectId": 1}` を送信
- **Then（結果）**:
  - HTTPステータス 201 が返る
  - `status` が `TODO`、`priority` が `MEDIUM`
  - `assigneeId` と `dueDate` が null

#### シナリオ2: 全項目を指定してタスクを作成

- **Given（前提）**: プロジェクト（id: 1）とタグ（id: 1, 2）が存在する
- **When（操作）**: POST /tasks に以下を送信
  ```json
  {
    "title": "重要タスク",
    "description": "詳細説明",
    "projectId": 1,
    "status": "IN_PROGRESS",
    "priority": "HIGH",
    "dueDate": "2025-01-31T23:59:59Z",
    "assigneeId": 123,
    "tagIds": [1, 2]
  }
  ```
- **Then（結果）**:
  - HTTPステータス 201 が返る
  - すべての項目が指定値で設定される
  - `tags` に2件のタグ情報が含まれる

### 異常系

#### シナリオ3: タイトルが空の場合

- **Given（前提）**: プロジェクトが存在する
- **When（操作）**: POST /tasks に `{"title": "", "projectId": 1}` を送信
- **Then（結果）**:
  - HTTPステータス 400 が返る
  - エラーコード `TASK_TASK_VALIDATION_ERROR`

#### シナリオ4: プロジェクトIDが未指定

- **Given（前提）**: -
- **When（操作）**: POST /tasks に `{"title": "タスク"}` を送信（projectIdなし）
- **Then（結果）**:
  - HTTPステータス 400 が返る
  - エラーコード `TASK_TASK_VALIDATION_ERROR`

#### シナリオ5: 存在しないプロジェクトIDを指定

- **Given（前提）**: プロジェクトID 999 は存在しない
- **When（操作）**: POST /tasks に `{"title": "タスク", "projectId": 999}` を送信
- **Then（結果）**:
  - HTTPステータス 404 が返る
  - エラーコード `TASK_PROJECT_NOT_FOUND`

#### シナリオ6: 無効なステータスを指定

- **Given（前提）**: プロジェクトが存在する
- **When（操作）**: POST /tasks に `{"title": "タスク", "projectId": 1, "status": "INVALID"}` を送信
- **Then（結果）**:
  - HTTPステータス 400 が返る
  - エラーコード `TASK_TASK_VALIDATION_ERROR`

## 関連

- US001: プロジェクト作成（先にプロジェクトが必要）
- US004: タスク一覧取得
- US005: タスクステータス更新
- US007: タグ管理（タグを紐づける場合）
