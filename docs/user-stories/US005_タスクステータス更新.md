# US005: タスクステータス更新

## ストーリー

MEMBERユーザーとして、
タスクのステータスを更新したい。
それにより、タスクの進捗を管理できる。

## 受け入れ基準

- タスクのステータスを TODO / IN_PROGRESS / DONE に変更できる
- ステータス以外の項目（タイトル、説明、優先度、期限、担当者）も更新できる
- 更新後のタスク情報が返却される
- 更新日時（updatedAt）が自動で更新される

## アンチパターン（これは仕様に含まない）

- ステータスの遷移順序に制約はない（DONEからTODOに戻すことも可能）
- 更新履歴は記録しない
- 複数タスクの一括更新はできない
- プロジェクトIDの変更（タスクの移動）はできない

## テストシナリオ

### 正常系

#### シナリオ1: ステータスをIN_PROGRESSに変更

- **Given（前提）**: タスク（id: 1, status: TODO）が存在する
- **When（操作）**: PATCH /tasks/1 に `{"status": "IN_PROGRESS"}` を送信
- **Then（結果）**:
  - HTTPステータス 200 が返る
  - `status` が `IN_PROGRESS` に変更されている
  - `updatedAt` が更新されている

#### シナリオ2: ステータスをDONEに変更

- **Given（前提）**: タスク（id: 1, status: IN_PROGRESS）が存在する
- **When（操作）**: PATCH /tasks/1 に `{"status": "DONE"}` を送信
- **Then（結果）**:
  - `status` が `DONE` に変更されている

#### シナリオ3: 複数項目を同時に更新

- **Given（前提）**: タスク（id: 1）が存在する
- **When（操作）**: PATCH /tasks/1 に以下を送信
  ```json
  {
    "title": "更新後のタイトル",
    "status": "IN_PROGRESS",
    "priority": "HIGH",
    "assigneeId": 456
  }
  ```
- **Then（結果）**:
  - すべての項目が更新されている

#### シナリオ4: 期限を削除

- **Given（前提）**: タスク（id: 1, dueDate: "2025-01-31"）が存在する
- **When（操作）**: PATCH /tasks/1 に `{"dueDate": null}` を送信
- **Then（結果）**:
  - `dueDate` が null になっている

#### シナリオ5: 担当者を解除

- **Given（前提）**: タスク（id: 1, assigneeId: 123）が存在する
- **When（操作）**: PATCH /tasks/1 に `{"assigneeId": null}` を送信
- **Then（結果）**:
  - `assigneeId` が null になっている

### 異常系

#### シナリオ6: 存在しないタスクを更新

- **Given（前提）**: タスクID 999 は存在しない
- **When（操作）**: PATCH /tasks/999 に `{"status": "DONE"}` を送信
- **Then（結果）**:
  - HTTPステータス 404 が返る
  - エラーコード `TASK_TASK_NOT_FOUND`

#### シナリオ7: 無効なステータス値

- **Given（前提）**: タスク（id: 1）が存在する
- **When（操作）**: PATCH /tasks/1 に `{"status": "INVALID"}` を送信
- **Then（結果）**:
  - HTTPステータス 400 が返る
  - エラーコード `TASK_TASK_VALIDATION_ERROR`

#### シナリオ8: タイトルを空にする

- **Given（前提）**: タスク（id: 1）が存在する
- **When（操作）**: PATCH /tasks/1 に `{"title": ""}` を送信
- **Then（結果）**:
  - HTTPステータス 400 が返る
  - エラーコード `TASK_TASK_VALIDATION_ERROR`

## 関連

- US003: タスク作成
- US004: タスク一覧取得
