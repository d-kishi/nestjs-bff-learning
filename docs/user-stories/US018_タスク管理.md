# US018: タスク管理

## ストーリー

認証済みユーザーとして、
Angularアプリケーションでタスクの一覧表示・作成・編集・削除を行いたい。
それにより、自分のタスクを効率的に管理できる。

## 受け入れ基準

- タスク一覧が表示される
- フィルター機能（プロジェクト、ステータス、優先度）が使用できる
- ソート機能（期限、作成日）が使用できる
- ページネーションで20件ずつ表示される
- タスクを新規作成できる
- タスクを編集できる
- 一覧上でステータスをインライン変更できる
- タスクを削除できる（確認ダイアログ表示）
- 操作成功時にトースト通知が表示される

## アンチパターン（これは仕様に含まない）

- タスク詳細画面（コメント・タグ管理）
- ドラッグ&ドロップによるステータス変更
- タスクの一括操作
- タスクへの担当者アサイン

---

## テストシナリオ

### 正常系

#### シナリオ1: タスク一覧表示

- **Given（前提）**:
  - ユーザーはログイン済み
  - ユーザーはタスク30件を所有
- **When（操作）**:
  - タスク一覧画面（`/tasks`）にアクセス
- **Then（結果）**:
  - 1ページ目に20件表示される
  - 各タスクにタイトル、プロジェクト名、ステータス、優先度、期限、操作ボタンが表示される
  - ステータスはドロップダウンで表示される

#### シナリオ2: フィルター（ステータス）

- **Given（前提）**:
  - タスク一覧画面を表示中
  - TODO 10件、IN_PROGRESS 5件、DONE 15件が存在
- **When（操作）**:
  - ステータスフィルターで「TODO」を選択
- **Then（結果）**:
  - TODOのタスク10件のみ表示される
  - ページネーションが更新される

#### シナリオ3: フィルター（プロジェクト）

- **Given（前提）**:
  - タスク一覧画面を表示中
  - プロジェクトA: 10件、プロジェクトB: 20件
- **When（操作）**:
  - プロジェクトフィルターで「プロジェクトA」を選択
- **Then（結果）**:
  - プロジェクトAのタスク10件のみ表示される

#### シナリオ4: ソート（期限昇順）

- **Given（前提）**:
  - タスク一覧画面を表示中
  - 様々な期限のタスクが存在
- **When（操作）**:
  - ソートで「期限 昇順」を選択
- **Then（結果）**:
  - 期限が近い順にタスクが並ぶ
  - 期限なしのタスクは最後に表示される

#### シナリオ5: タスク新規作成

- **Given（前提）**:
  - タスク一覧画面を表示中
  - プロジェクトが1件以上存在
- **When（操作）**:
  - 「+ 新規作成」ボタンをクリック
  - ダイアログが表示される
  - タイトルに「新規タスク」を入力
  - プロジェクトを選択
  - ステータスで「TODO」を選択
  - 優先度で「HIGH」を選択
  - 期限に「2025-01-20」を入力
  - 「保存」ボタンをクリック
- **Then（結果）**:
  - ダイアログが閉じる
  - 「タスクを作成しました」トーストが表示される
  - 一覧に新しいタスクが追加される

#### シナリオ6: インラインステータス変更

- **Given（前提）**:
  - タスク一覧画面を表示中
  - 「タスクA」がTODOステータス
- **When（操作）**:
  - 「タスクA」のステータスドロップダウンをクリック
  - 「IN_PROGRESS」を選択
- **Then（結果）**:
  - ステータスが即座に更新される
  - 「ステータスを更新しました」トーストが表示される
  - 一覧表示が更新される

#### シナリオ7: タスク編集

- **Given（前提）**:
  - タスク一覧画面を表示中
  - 「既存タスク」が存在
- **When（操作）**:
  - 「既存タスク」の「編集」ボタンをクリック
  - ダイアログが現在の値で表示される
  - タイトルを「更新後タスク」に変更
  - 「保存」ボタンをクリック
- **Then（結果）**:
  - ダイアログが閉じる
  - 「タスクを更新しました」トーストが表示される
  - 一覧のタスク名が更新される

#### シナリオ8: タスク削除

- **Given（前提）**:
  - タスク一覧画面を表示中
  - 「削除対象タスク」が存在
- **When（操作）**:
  - 「削除対象タスク」の「削除」ボタンをクリック
  - 確認ダイアログで「削除」をクリック
- **Then（結果）**:
  - 「タスクを削除しました」トーストが表示される
  - 一覧からタスクが削除される

---

### 異常系

#### シナリオ9: バリデーションエラー（タイトル未入力）

- **Given（前提）**:
  - 新規作成ダイアログを表示中
- **When（操作）**:
  - タイトルを空のまま
  - 「保存」ボタンをクリック
- **Then（結果）**:
  - APIリクエストは送信されない
  - タイトルフィールドに「必須項目です」エラーが表示される

#### シナリオ10: バリデーションエラー（プロジェクト未選択）

- **Given（前提）**:
  - 新規作成ダイアログを表示中
- **When（操作）**:
  - タイトルを入力
  - プロジェクトを選択しない
  - 「保存」ボタンをクリック
- **Then（結果）**:
  - プロジェクトフィールドに「必須項目です」エラーが表示される

#### シナリオ11: プロジェクトが存在しない場合

- **Given（前提）**:
  - ユーザーはプロジェクトを0件所有
- **When（操作）**:
  - 「+ 新規作成」ボタンをクリック
- **Then（結果）**:
  - ダイアログに「先にプロジェクトを作成してください」メッセージが表示される
  - または「保存」ボタンが無効化される

---

## E2Eテスト（/webapp-testing用）

### テストスイート構成

```typescript
describe('タスク管理', () => {
  beforeEach(() => {
    // ログイン済み状態をセットアップ
    // テスト用プロジェクト・タスクを作成
  });

  describe('一覧表示', () => {
    it('タスク一覧が表示される');
    it('ページネーションで次ページに遷移できる');
  });

  describe('フィルター・ソート', () => {
    it('ステータスでフィルターできる');
    it('プロジェクトでフィルターできる');
    it('優先度でフィルターできる');
    it('期限でソートできる');
  });

  describe('CRUD操作', () => {
    it('タスクを新規作成できる');
    it('タスクを編集できる');
    it('インラインでステータスを変更できる');
    it('タスクを削除できる');
  });

  describe('バリデーション', () => {
    it('タイトル未入力でエラーが表示される');
    it('プロジェクト未選択でエラーが表示される');
  });
});
```

---

## 関連ドキュメント

- `docs/design/angular-ui-design.md` - タスク一覧画面ワイヤーフレーム
- `docs/design/api-gateway-api.md` - タスクAPI仕様
- `docs/user-stories/US003_タスク作成.md` - バックエンド仕様
- `docs/user-stories/US004_タスク一覧取得.md` - バックエンド仕様
- `docs/user-stories/US005_タスクステータス更新.md` - バックエンド仕様
