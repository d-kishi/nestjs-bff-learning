# US017: プロジェクト管理

## ストーリー

認証済みユーザーとして、
Angularアプリケーションでプロジェクトの一覧表示・作成・編集・削除を行いたい。
それにより、タスクを整理するためのプロジェクトを管理できる。

## 受け入れ基準

- プロジェクト一覧が表示される
- ページネーションで20件ずつ表示される
- 新規プロジェクトを作成できる
- プロジェクトを編集できる
- プロジェクトを削除できる（確認ダイアログ表示）
- 操作成功時にトースト通知が表示される
- バリデーションエラーがフォームに表示される

## アンチパターン（これは仕様に含まない）

- プロジェクト詳細画面（プロジェクト配下のタスク一覧）
- プロジェクトの検索・フィルター機能
- プロジェクトメンバー管理

---

## テストシナリオ

### 正常系

#### シナリオ1: プロジェクト一覧表示

- **Given（前提）**:
  - ユーザーはログイン済み
  - ユーザーはプロジェクト25件を所有
- **When（操作）**:
  - プロジェクト一覧画面（`/projects`）にアクセス
- **Then（結果）**:
  - 1ページ目に20件表示される
  - 各プロジェクトに名前、説明、作成日、操作ボタンが表示される
  - ページネーションに「ページ 1 / 2」と表示される

#### シナリオ2: ページネーション

- **Given（前提）**:
  - ユーザーはプロジェクト一覧1ページ目を表示中
  - 全25件のプロジェクトが存在
- **When（操作）**:
  - 「次へ」ボタンをクリック
- **Then（結果）**:
  - 2ページ目（残り5件）が表示される
  - 「前へ」ボタンが有効になる
  - 「次へ」ボタンが無効になる

#### シナリオ3: プロジェクト新規作成

- **Given（前提）**:
  - ユーザーはプロジェクト一覧画面を表示中
- **When（操作）**:
  - 「+ 新規作成」ボタンをクリック
  - ダイアログが表示される
  - 名前に「新規プロジェクト」を入力
  - 説明に「テスト用プロジェクト」を入力
  - 「保存」ボタンをクリック
- **Then（結果）**:
  - ダイアログが閉じる
  - 「プロジェクトを作成しました」トーストが表示される
  - 一覧に新しいプロジェクトが追加される

#### シナリオ4: プロジェクト編集

- **Given（前提）**:
  - ユーザーはプロジェクト一覧画面を表示中
  - 「既存プロジェクト」が存在
- **When（操作）**:
  - 「既存プロジェクト」の「編集」ボタンをクリック
  - ダイアログが現在の値で表示される
  - 名前を「更新後プロジェクト」に変更
  - 「保存」ボタンをクリック
- **Then（結果）**:
  - ダイアログが閉じる
  - 「プロジェクトを更新しました」トーストが表示される
  - 一覧のプロジェクト名が「更新後プロジェクト」に更新される

#### シナリオ5: プロジェクト削除

- **Given（前提）**:
  - ユーザーはプロジェクト一覧画面を表示中
  - 「削除対象プロジェクト」が存在
- **When（操作）**:
  - 「削除対象プロジェクト」の「削除」ボタンをクリック
  - 確認ダイアログ「本当に削除しますか？」が表示される
  - 「削除」ボタンをクリック
- **Then（結果）**:
  - 確認ダイアログが閉じる
  - 「プロジェクトを削除しました」トーストが表示される
  - 一覧からプロジェクトが削除される

#### シナリオ6: 削除キャンセル

- **Given（前提）**:
  - ユーザーはプロジェクト一覧画面を表示中
- **When（操作）**:
  - 「削除」ボタンをクリック
  - 確認ダイアログで「キャンセル」をクリック
- **Then（結果）**:
  - ダイアログが閉じる
  - プロジェクトは削除されない

---

### 異常系

#### シナリオ7: バリデーションエラー（名前未入力）

- **Given（前提）**:
  - 新規作成ダイアログを表示中
- **When（操作）**:
  - 名前フィールドを空のまま
  - 「保存」ボタンをクリック
- **Then（結果）**:
  - APIリクエストは送信されない
  - 名前フィールドに「必須項目です」エラーが表示される

#### シナリオ8: サーバーエラー

- **Given（前提）**:
  - 新規作成ダイアログを表示中
  - バックエンドが障害中
- **When（操作）**:
  - 有効な値を入力
  - 「保存」ボタンをクリック
- **Then（結果）**:
  - エラートースト「エラーが発生しました」が表示される
  - ダイアログは開いたまま（再試行可能）

#### シナリオ9: 削除失敗（関連タスクあり）

- **Given（前提）**:
  - プロジェクトにタスクが紐づいている
- **When（操作）**:
  - 「削除」ボタンをクリック
  - 確認ダイアログで「削除」をクリック
- **Then（結果）**:
  - エラートースト「関連するタスクが存在するため削除できません」が表示される
  - プロジェクトは削除されない

---

## E2Eテスト（/webapp-testing用）

### テストスイート構成

```typescript
describe('プロジェクト管理', () => {
  beforeEach(() => {
    // ログイン済み状態をセットアップ
  });

  describe('一覧表示', () => {
    it('プロジェクト一覧が表示される');
    it('ページネーションで次ページに遷移できる');
  });

  describe('CRUD操作', () => {
    it('プロジェクトを新規作成できる');
    it('プロジェクトを編集できる');
    it('プロジェクトを削除できる');
    it('削除をキャンセルできる');
  });

  describe('バリデーション', () => {
    it('名前未入力でエラーが表示される');
  });
});
```

---

## 関連ドキュメント

- `docs/design/angular-ui-design.md` - プロジェクト一覧画面ワイヤーフレーム
- `docs/design/api-gateway-api.md` - プロジェクトAPI仕様
- `docs/user-stories/US001_プロジェクト作成.md` - バックエンド仕様
- `docs/user-stories/US002_プロジェクト一覧取得.md` - バックエンド仕様
