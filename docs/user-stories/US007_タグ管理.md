# US007: タグ管理

## ストーリー

MEMBERユーザーとして、
タグを作成・管理し、タスクに付与したい。
それにより、タスクを分類・検索しやすくできる。

## 受け入れ基準

- タグを作成できる（名前は必須、色は任意）
- タグ名はユニーク（重複不可）
- タグ名は1〜50文字
- 色はHEXカラー形式（#RRGGBB）
- タスクにタグを追加・削除できる
- タグ一覧を取得できる（名前で部分一致検索可能）

## アンチパターン（これは仕様に含まない）

- タグの階層構造（親子関係）はない
- タグのグループ化機能はない
- タグの使用回数制限はない
- 同じタスクに同じタグを複数回付与することはできない
- タグ削除時、そのタグが付与されたタスクからは自動で外れる

## テストシナリオ

### 正常系

#### シナリオ1: タグを作成

- **Given（前提）**: ユーザーがログイン中
- **When（操作）**: POST /tags に `{"name": "urgent", "color": "#FF0000"}` を送信
- **Then（結果）**:
  - HTTPステータス 201 が返る
  - `id`, `name`, `color`, `createdAt` が返る

#### シナリオ2: 色なしでタグを作成

- **Given（前提）**: ユーザーがログイン中
- **When（操作）**: POST /tags に `{"name": "backend"}` を送信
- **Then（結果）**:
  - HTTPステータス 201 が返る
  - `color` が null で返る

#### シナリオ3: タグ一覧を取得

- **Given（前提）**: タグが5件登録されている
- **When（操作）**: GET /tags を送信
- **Then（結果）**:
  - HTTPステータス 200 が返る
  - `data` に5件のタグが含まれる

#### シナリオ4: タグ名で検索

- **Given（前提）**: "frontend", "backend", "urgent" のタグがある
- **When（操作）**: GET /tags?search=end を送信
- **Then（結果）**:
  - `data` に "frontend", "backend" の2件が含まれる

#### シナリオ5: タスクにタグを追加

- **Given（前提）**: タスク（id: 1）とタグ（id: 1）が存在する
- **When（操作）**: POST /tasks/1/tags に `{"tagId": 1}` を送信
- **Then（結果）**:
  - HTTPステータス 200 が返る
  - レスポンスのタスクに `tags` が含まれる

#### シナリオ6: タスクからタグを削除

- **Given（前提）**: タスク（id: 1）にタグ（id: 1）が付与されている
- **When（操作）**: DELETE /tasks/1/tags/1 を送信
- **Then（結果）**:
  - HTTPステータス 204 が返る
  - タスクからタグが外れている

#### シナリオ7: タグを更新

- **Given（前提）**: タグ（id: 1, name: "urgent"）が存在する
- **When（操作）**: PATCH /tags/1 に `{"name": "critical", "color": "#FF5500"}` を送信
- **Then（結果）**:
  - HTTPステータス 200 が返る
  - `name` と `color` が更新されている

#### シナリオ8: タグを削除

- **Given（前提）**: タグ（id: 1）が存在し、タスクに付与されている
- **When（操作）**: DELETE /tags/1 を送信
- **Then（結果）**:
  - HTTPステータス 204 が返る
  - タグが削除され、タスクとの関連も削除されている

### 異常系

#### シナリオ9: 同名のタグを作成

- **Given（前提）**: "urgent" というタグが既に存在する
- **When（操作）**: POST /tags に `{"name": "urgent"}` を送信
- **Then（結果）**:
  - HTTPステータス 409 が返る
  - エラーコード `TASK_TAG_ALREADY_EXISTS`

#### シナリオ10: 空のタグ名で作成

- **Given（前提）**: -
- **When（操作）**: POST /tags に `{"name": ""}` を送信
- **Then（結果）**:
  - HTTPステータス 400 が返る
  - エラーコード `TASK_TAG_VALIDATION_ERROR`

#### シナリオ11: 不正な色形式

- **Given（前提）**: -
- **When（操作）**: POST /tags に `{"name": "test", "color": "red"}` を送信
- **Then（結果）**:
  - HTTPステータス 400 が返る
  - エラーコード `TASK_TAG_VALIDATION_ERROR`

#### シナリオ12: 既に付与されているタグを再度追加

- **Given（前提）**: タスク（id: 1）にタグ（id: 1）が既に付与されている
- **When（操作）**: POST /tasks/1/tags に `{"tagId": 1}` を送信
- **Then（結果）**:
  - HTTPステータス 409 が返る
  - エラーコード `TASK_TASK_TAG_ALREADY_EXISTS`

#### シナリオ13: 存在しないタグをタスクに追加

- **Given（前提）**: タグID 999 は存在しない
- **When（操作）**: POST /tasks/1/tags に `{"tagId": 999}` を送信
- **Then（結果）**:
  - HTTPステータス 404 が返る
  - エラーコード `TASK_TAG_NOT_FOUND`

## 関連

- US003: タスク作成（タグを紐づけて作成可能）
- US004: タスク一覧取得（タグでフィルタリング可能）
