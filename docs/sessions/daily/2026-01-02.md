# 2026-01-02 セッション記録

## セッション概要

| 項目 | 内容 |
|------|------|
| 目的 | Phase 1設計作業（task-serviceエンティティ・API設計、ユーザーストーリー作成） |
| 作業特性 | 新機能実装（設計フェーズ） |

## 完了事項

### 設計ドキュメント作成

- `docs/design/README.md` - 設計ドキュメントディレクトリ作成
- `docs/design/task-service-entities.md` - エンティティ詳細設計
  - Project, Task, Comment, Tag の4エンティティ
  - TypeORM Entity定義（デコレータ、リレーション設定）
  - Oracle固有の考慮事項（ENUMは文字列、カラム名明示）
  - インデックス設計
  - サービス間参照の設計判断（外部キー制約なし）
- `docs/design/task-service-api.md` - API設計
  - 21エンドポイントの定義
  - リクエスト/レスポンス形式
  - DTOバリデーションルール
  - エラーコード一覧

### ユーザーストーリー作成

| ID | タイトル | 正常系 | 異常系 |
|----|---------|--------|--------|
| US001 | プロジェクト作成 | 2件 | 3件 |
| US002 | プロジェクト一覧取得 | 4件 | 1件 |
| US003 | タスク作成 | 2件 | 4件 |
| US004 | タスク一覧取得 | 6件 | 1件 |
| US005 | タスクステータス更新 | 5件 | 3件 |
| US006 | コメント投稿 | 5件 | 4件 |
| US007 | タグ管理 | 8件 | 5件 |

### プロジェクト管理ファイル更新

- `docs/sessions/project-status.md` - Phase状況更新
- `docs/sessions/task-checklist.md` - 設計作業完了マーク

## 技術的知見・学び

### エンティティ設計の判断

- **サービス間参照**: owner_id, assignee_id, author_id は外部キー制約なしで論理参照とする
  - 理由: マイクロサービス間の独立性確保
  - 整合性はAPI呼び出し時にBFF層で確認

- **OracleでのENUM**: MySQL/PostgreSQLのようなENUM型がないため、VARCHAR + TypeScript enumで対応

- **中間テーブル**: task_tags は TypeORM の `@JoinTable` で自動生成（エンティティクラス不要）

### API設計の判断

- **コメントAPIのパス設計**:
  - 作成・一覧: `/tasks/:taskId/comments`（タスクにネスト）
  - 更新・削除: `/comments/:id`（直接アクセス）
  - RESTの慣例に従った使い分け

## 発生した問題と解決

特になし

## 未完了・継続事項

- [ ] TDD実現のためのSkills作成
- [ ] Phase 1実装（TDDサイクルで実施）

## 次回への申し送り

### 作業順序

1. **TDD Skills作成**
   - テスト駆動開発のワークフローをSkillsとして定義
   - Red-Green-Refactorサイクルの実装ガイド

2. **Phase 1実装（TDDサイクル）**
   - task-service雛形作成（nest new）
   - TypeORM + Oracle接続設定
   - エンティティ実装（テストファースト）
   - API実装（テストファースト）

### 実装の優先順位

```
Project CRUD → Task CRUD → Comment CRUD → Tag CRUD
```

各機能について以下のTDDサイクルで実装:
1. テストを書く（Red）
2. 最小限の実装（Green）
3. リファクタリング（Refactor）

### 参照すべきドキュメント

| 用途 | ファイル |
|------|---------|
| エンティティ実装 | `docs/design/task-service-entities.md` |
| API実装 | `docs/design/task-service-api.md` |
| テストシナリオ | `docs/user-stories/US001〜US007` |

### 技術スタック確認

- NestJS + TypeORM + Oracle XE
- Jest（Unit Test + API E2E）
- DevContainer環境で実行

### 注意点

- task-serviceのowner_id等はダミー値（123等）でテスト可能
- user-serviceは Phase 2 で実装（task-service完了後）
