# 2026-01-29 セッション記録

## セッション概要

| 項目 | 内容 |
|------|------|
| 目的 | BFFパターン学習資料の作成 |
| 作業特性 | 学習資料作成 |

## 完了事項

- [x] BFFパターン学習資料作成（`docs/learning/bff-pattern.md`）
  - サービスクライアントの実装パターン（HttpModule、AxiosError処理）
  - 認証ヘッダ伝播（X-User-Id、X-User-Roles）
  - Proxyパターン（薄いController/Service層）
  - データ集約パターン（Dashboard、Promise.allSettled()）
  - 部分失敗ハンドリング（_errorsフィールド）
  - BFF固有例外クラス（BffServiceUnavailableException等）
- [x] 学習資料README更新
- [x] project-status.md更新（学習資料進捗を完了に）
- [x] Claude Code v2.1.20以降のアップデート調査
  - v2.1.22までの主要変更点を調査・報告
  - サブディレクトリCLAUDE.mdの自動読み込み機能を確認

## 技術的知見・学び

### BFFパターンの主要概念

| 項目 | 内容 |
|------|------|
| 目的 | フロントエンド専用のバックエンドを提供 |
| 認証 | BFFでJWT検証、内部はカスタムヘッダで伝播 |
| Proxy層 | ビジネスロジックは下流に委譲、BFFは薄く |
| データ集約 | `Promise.allSettled()`で並列取得 |
| 部分失敗 | 一部障害でも応答可能、`_errors`で通知 |

### Promise.all vs Promise.allSettled

- `Promise.all()`: 1つでも失敗すると即座にreject
- `Promise.allSettled()`: すべて完了まで待機、個別結果を返却

### AxiosErrorコード分類

| コード | 状況 | BFF対応 |
|--------|------|---------|
| ECONNABORTED | リクエストタイムアウト | 504 |
| ETIMEDOUT | 接続タイムアウト | 504 |
| ECONNREFUSED | サービス停止 | 503 |
| ENOTFOUND | DNS解決失敗 | 503 |

### Claude Code v2.1.20以降の主要アップデート

| バージョン | 主要変更 |
|-----------|---------|
| v2.1.22 | 非インタラクティブモード構造化出力修正 |
| v2.1.21 | 日本語IME対応、ファイル操作ツール優先化 |
| v2.1.20 | PRレビューステータス表示、`--add-dir`でCLAUDE.md読み込み |
| v2.1.19 | タスク管理システム刷新（依存関係追跡） |
| v2.1.18 | キーバインディングカスタマイズ機能 |

### サブディレクトリCLAUDE.mdの自動読み込み

- サブディレクトリに配置したCLAUDE.mdは、そのサブツリー内のファイルを操作する際に自動読み込み
- 起動時ではなく「遅延読み込み」方式
- `--add-dir`はワーキングディレクトリ外のディレクトリを追加する別機能

## 発生した問題と解決

特になし

## 未完了・継続事項

- [ ] 開発環境モダナイゼーション（Issue #2）
- [ ] 共通パッケージ実装（Issue #5）
- [ ] WSL環境移行（Issue #4）

## 次回への申し送り

- NestJS学習資料は全9件完成
- 主要トピック網羅済み（Controller、DTO、Filter/Interceptor、Guard、Entity、BFF）
- 次回は開発環境モダナイゼーションまたは機能拡張を検討

## 変更ファイル一覧

| ファイル | 変更内容 |
|---------|---------|
| `docs/learning/bff-pattern.md` | 新規作成（BFFパターン学習資料） |
| `docs/learning/README.md` | 資料一覧にbff-pattern.md追加 |
| `docs/sessions/project-status.md` | 学習資料進捗を完了に更新 |
| `docs/sessions/daily/2026-01-29.md` | 新規作成（本セッション記録） |
