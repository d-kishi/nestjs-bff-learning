# 2026-01-02 セッション記録 (2)

## セッション概要

| 項目 | 内容 |
|------|------|
| 目的 | TDD Skills作成、Forced Eval Hook導入 |
| 作業特性 | 新機能実装（開発環境整備） |

## 完了事項

### TDD Skills作成
- `.claude/skills/tdd/SKILL.md` - TDD開発ワークフロー定義
  - Red-Green-Refactorサイクルのガイドライン
  - High freedomアプローチ（テキストベース指示のみ）
  - NestJS固有コードサンプルなし（Claudeの知識に委任）

### Forced Eval Hook導入
Issue #9716（Skills自動発動問題）の回避策として導入

| ファイル | 内容 |
|---------|------|
| `.claude/hooks/src/index.ts` | UserPromptSubmit Hook実装 |
| `.claude/hooks/scripts/generate-triggers.ts` | トリガー自動生成スクリプト |
| `.claude/hooks/package.json` | npm設定 |
| `.claude/hooks/tsconfig.json` | TypeScript設定 |
| `.claude/hooks/config.json` | Skills評価 On/Off設定 |
| `.claude/hooks/skills-triggers.json` | 自動生成されたトリガー定義 |
| `.claude/settings.local.json` | hooks設定追加 |

自動抽出されたトリガーキーワード:
```json
["実装", "エンティティ", "サービス", "API", "機能", "テスト駆動", "TDD"]
```

## 技術的知見・学び

### Skills自動発動問題（Issue #9716）
- Claude CodeがSkillsを自動認識・使用しない既知問題
- available_skillsに記載されていても、プロアクティブには使用しない
- Forced Eval Hook（UserPromptSubmit Hook）で回避可能
- 成功率: 対策なし ~0% → Hook導入後 84%

### skill-creator活用
- `document-skills:skill-creator`がavailable_skillsに存在
- 今回は使用せずにベストプラクティスから直接作成
- 結果は同等（skill-creator使用でも同様の成果物になる）

### トリガーキーワード抽出
- SKILL.mdのdescriptionから「」で囲まれた部分を自動抽出
- `npm run build`でgenerate-triggers.ts実行 → skills-triggers.json生成

## 発生した問題と解決

### 問題1: available_skillsの見落とし
- **原因**: システムプロンプト内のavailable_skillsを十分に確認しなかった
- **解決策**: Issue #9716と同様の既知問題。Forced Eval Hook導入で対応

### 問題2: 参考プロジェクトのブランチ間違い
- **原因**: Forced Eval Hook未適用のブランチを参照
- **解決策**: ユーザーがブランチ切り替え後、再調査

## 未完了・継続事項

- [ ] Claude Code再起動後、TDD Skillの動作確認
- [ ] task-service雛形作成（nest new）
- [ ] TypeORM + Oracle接続設定
- [ ] エンティティ実装（テストファースト）
- [ ] API実装（テストファースト）

## 次回への申し送り

### 動作確認必須
- Claude Code再起動後、「エンティティを実装してください」等のプロンプトでHook動作確認
- TDD Skillの評価指示が自動注入されることを確認

### 実装開始
- task-service雛形作成から開始
- TDDサイクルで実装（テストファースト）
- 設計参照: `docs/design/task-service-entities.md`, `docs/design/task-service-api.md`

### Forced Eval Hook拡張
- 新規Skills追加時: SKILL.mdのdescriptionに「」付きキーワードを記載
- `.claude/hooks`で`npm run build`を実行
