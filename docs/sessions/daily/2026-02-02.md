# 2026-02-02 セッション記録

## セッション概要

| 項目 | 内容 |
|------|------|
| 目的 | WSL + Sandbox 環境でのアプリケーション起動対応（Issue #2） |
| 作業特性 | 環境構築 / 設定修正 |

## 完了事項

### 1. WSL + Sandbox 環境でのアプリケーション起動対応

- `/tmp/claude` ディレクトリ作成（Sandbox 用一時ディレクトリ）
- Oracle XE コンテナ確認（既存コンテナ `nestjs-bff-learning_devcontainer-oracle-1` が稼働中）
- `.env` ファイル作成
  - `services/task-service/.env`
  - `services/user-service/.env`
- 全サービス起動確認
  - api-gateway: http://localhost:3000/ → 200 OK
  - task-service: http://localhost:3001/ → 200 OK
  - user-service: http://localhost:3002/ → 200 OK
  - Angular: http://localhost:4200/ → 200 OK

### 2. VSCode デバッグ設定修正

- `.vscode/launch.json` の `runtimeExecutable` を `npm` → `pnpm` に変更
- Angular の `serverReadyAction` の `pattern` からキャプチャグループを削除（エラーダイアログ対策）

### 3. 新規 Issue 作成

- **Issue #7**: [WSL環境でlocalhostからサービスにアクセスできない](https://github.com/d-kishi/nestjs-bff-learning/issues/7)
- **Issue #8**: [全バックエンドサービスにSwagger UIを実装する](https://github.com/d-kishi/nestjs-bff-learning/issues/8)

### 4. Issue #2 クローズ

- 対応内容をコメントに記載
- Issue #2（開発環境モダナイゼーション）をクローズ

## 技術的知見・学び

- WSL2 の NAT モードでは Windows ブラウザから `localhost` でアクセスできない場合がある
- 解決策: WSL IP アドレスを使用するか、`networkingMode=mirrored` に変更
- Claude Code の Sandbox モードでは `/tmp/claude` ディレクトリが必要

## 発生した問題と解決

### 問題1: api-gateway 起動時にエラーダイアログ表示

- **原因**: `launch.json` の Angular 設定で `pattern` にキャプチャグループがあるのに `uriFormat` にプレースホルダーがない
- **解決策**: `pattern` から `(https?://\\S+)` キャプチャグループを削除

### 問題2: VSCode デバッグで npm が見つからない

- **原因**: mise 環境で npm がインストールされていない（pnpm + bun 構成）
- **解決策**: `launch.json` の `runtimeExecutable` を `pnpm` に変更

### 問題3: Windows ブラウザから localhost でアクセスできない

- **原因**: WSL2 NAT モードでの localhost 転送問題
- **解決策**: WSL IP アドレス（例: `172.30.69.145`）を使用（Issue #7 で mirrored モード対応を検討）

### 問題4: UserPromptSubmit hook error

- **原因**: 不明（再現せず）
- **対応**: 再発時に調査

## 未完了・継続事項

- [ ] Issue #7: WSL 環境で localhost からサービスにアクセスできない
- [ ] Issue #8: 全バックエンドサービスに Swagger UI を実装する

## 次回への申し送り

- Windows ブラウザからのアクセスは WSL IP アドレスを使用する必要あり
- UserPromptSubmit hook error が再発した場合はエラーメッセージ全文を確認
- Swagger 未実装のため `launch.json` の api-gateway `serverReadyAction` は `/api` 開かない状態

## 変更ファイル一覧

| ファイル | 変更内容 |
|---------|---------|
| `services/task-service/.env` | 新規作成（Oracle 接続設定） |
| `services/user-service/.env` | 新規作成（Oracle 接続設定） |
| `.vscode/launch.json` | pnpm 対応、Angular pattern 修正 |
