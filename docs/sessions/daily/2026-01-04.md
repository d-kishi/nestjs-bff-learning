# 2026-01-04 セッション記録

## セッション概要

| 項目 | 内容 |
|------|------|
| 目的 | アプリケーション動作確認の準備・実行 |
| 作業特性 | 環境構築 / 動作確認 |

## 完了事項

### 1. DevContainer改行コード問題の解決
- `devcontainer.json`の`postCreateCommand`に`git config core.autocrlf input`を追加
- Windows（CRLF）とLinuxコンテナ（LF）間の改行コード差異による誤検出を防止

### 2. アプリケーション動作確認準備
- Oracleスキーマ作成（USER_DB, TASK_DB, USER_DB_TEST, TASK_DB_TEST）
- バックエンドサービス起動（user-service:3002, task-service:3001, api-gateway:3000）
- テストユーザー登録（admin@example.com / Password123）
- ADMINロール付与（SQL実行）
- ユーザーアカウント有効化（isActive: true）

### 3. Angular外部アクセス設定
- `angular.json`の`serve.options`に`host: "0.0.0.0"`を追加
- DevContainer外（ホストマシン）からのアクセスを可能に

## 技術的知見・学び

### DevContainer + Windows環境でのgit改行コード
- Windows側で`core.autocrlf=true`の場合、ファイルがCRLFで保存される
- Linuxコンテナ内のgitはこれを「変更」と認識してしまう
- `git config core.autocrlf input`でコミット時にLFに正規化することで解決

### Angular ng serve のホスト設定
- デフォルトでは`localhost`のみでリッスン
- Docker環境では`--host 0.0.0.0`が必要
- `angular.json`の`serve.options.host`で永続化可能

### Oracle識別子の引用符
- 小文字のテーブル名・カラム名はダブルクォートで囲む必要がある
- 例: `SELECT "id", "email" FROM USER_DB."users"`

## 発生した問題と解決

### 問題1: git statusで全ファイルが変更扱い
- **原因**: Windows（CRLF）とLinuxコンテナ（LF）間の改行コード差異
- **解決策**: `devcontainer.json`に`git config core.autocrlf input`を追加

### 問題2: Oracle接続エラー（ORA-01017）
- **原因**: DevContainerリビルド後、スキーマが未作成
- **解決策**: SQLでUSER_DB/TASK_DBスキーマを手動作成

### 問題3: Angular外部アクセス不可
- **原因**: `ng serve`がデフォルトで`localhost`のみリッスン
- **解決策**: `angular.json`に`host: "0.0.0.0"`を追加

### 問題4: ログインエラー（Account is disabled）
- **原因**: ユーザー登録時に`isActive: false`で作成されていた
- **解決策**: SQLで`is_active = 1`に更新

## 未完了・継続事項

なし（動作確認準備完了）

## 次回への申し送り

### 動作確認環境
- テストユーザー: admin@example.com / Password123（ADMIN, MEMBERロール）
- サービス起動コマンド: `npm run start:user`, `npm run start:task`, `npm run start:gateway`, `npm run start:angular`
- Angular URL: http://localhost:4200/login

### 注意点
- DevContainerリビルド後はOracleスキーマの再作成が必要
- ユーザー登録APIは`isActive: true`で作成されるよう修正済み（手動有効化は不要）
